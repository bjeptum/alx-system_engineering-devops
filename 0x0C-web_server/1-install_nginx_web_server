#!/usr/bin/env bash
# Install Nginx
sudo apt-get update
sudo apt-get install nginx -y

#Adjust the firewall
sudo ufw allow 'Nginx HTTP'
# Configure Nginx to listen on port 80
sudo sed -i 's/listen 80 default_server;/listen 80;/' /etc/nginx/sites-available/default

#Configure Nginx to return "Hello World!" at the root path
echo "Hello World!" > /var/www/html/index.html

# Enable the new site
sudo ln -s /etc/nginx/sites-available/hello-world /etc/nginx/sites-enabled/hello-world

# Ensure all files end with a newline character
find . -type f -exec sed -i -e '$a\' {} \;

# Create a README.md file in the root directory
touch README.md

# Use allowed text editors
echo 'export VISUAL=vim' >> ~/.bashrc
echo 'export EDITOR="$VISUAL"' >> ~/.bashrc

# Make all Bash scripts executable
find . -name "*.sh" -type f -exec chmod +x {} \;

# Install Shellcheck
sudo apt-get install shellcheck -y

# Ensure all Bash scripts pass Shellcheck without any errors
find . -name "*.sh" -type f -print0 | xargs -0 shellcheck --version 0.3.7 -s bash

# Ensure the first line of all Bash scripts is exactly #!/usr/bin/env bash
find . -name "*.sh" -type f -exec sed -i '1s;^;#!/usr/bin/env bash\n;' {} \;

# Ensure the second line of all Bash scripts is a comment explaining what the script is doing
find . -name "*.sh" -type f -exec sed -i '2s;^;# This script performs the following tasks:\n;' {} \;

# Disable systemctl usage for restarting processes
alias systemctl='echo "Systemctl usage is not allowed."'

# Restart Nginx
sudo service Nginx restart
